<section class="form-section" *ngIf="multiImage">
  <h3 mat-subheader>Multi-Image Settings</h3>
  <mat-form-field appearance="outline" class="form-field">
    <mat-label>Minimum Images</mat-label>
    <input matInput type="number" [(ngModel)]="multiImage.minImages" (ngModelChange)="onMultiImageChange()" name="minImages" min="1" required>
  </mat-form-field>
  <mat-form-field appearance="outline" class="form-field">
    <mat-label>Maximum Images</mat-label>
    <input matInput type="number" [(ngModel)]="multiImage.maxImages" (ngModelChange)="onMultiImageChange()" name="maxImages" min="1" required>
  </mat-form-field>

  <div class="images-list">
    <h4>Images</h4>
    <ng-container *ngFor="let img of multiImage.images; let i = index">
      <mat-card class="image-card">
        <mat-card-header>
          <mat-card-title>Image {{ i + 1 }}</mat-card-title>
          <button mat-icon-button color="warn" (click)="removeImage(i)" [disabled]="!multiImage.images || multiImage.images.length <= 1" matTooltip="Remove Image">
            <mat-icon>delete</mat-icon>
          </button>
        </mat-card-header>
        <mat-card-content>
          <!-- Inline image editor fields -->
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Set URL</mat-label>
            <input matInput [(ngModel)]="img.setUrl" (ngModelChange)="onMultiImageChange()" name="imageSetUrl{{i}}" placeholder="https://...">
          </mat-form-field>
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Media Type</mat-label>
            <mat-select [(ngModel)]="img.mediaType" (selectionChange)="onMultiImageChange()" name="imageMediaType{{i}}">
              <mat-option *ngFor="let type of mediaTypes" [value]="type">{{ type }}</mat-option>
            </mat-select>
          </mat-form-field>
          <mat-grid-list cols="3" rowHeight="fit" gutterSize="16px">
            <mat-grid-tile *ngIf="img.dimensions">
              <mat-form-field appearance="outline" class="form-field">
                <mat-label>Width (px)</mat-label>
                <input matInput type="number" [(ngModel)]="img.dimensions.width" (ngModelChange)="onMultiImageChange()" name="imageWidth{{i}}" min="1">
              </mat-form-field>
            </mat-grid-tile>
            <mat-grid-tile *ngIf="img.dimensions">
              <mat-form-field appearance="outline" class="form-field">
                <mat-label>Height (px)</mat-label>
                <input matInput type="number" [(ngModel)]="img.dimensions.height" (ngModelChange)="onMultiImageChange()" name="imageHeight{{i}}" min="1">
              </mat-form-field>
            </mat-grid-tile>
            <mat-grid-tile *ngIf="img.dimensions">
              <mat-form-field appearance="outline" class="form-field">
                <mat-label>Aspect Ratio</mat-label>
                <mat-select [(ngModel)]="img.dimensions.aspectRatio" (selectionChange)="onMultiImageChange()" name="imageAspectRatio{{i}}">
                  <mat-option *ngFor="let ratio of aspectRatios" [value]="ratio.value">{{ ratio.label }}</mat-option>
                </mat-select>
              </mat-form-field>
            </mat-grid-tile>
          </mat-grid-list>
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Resolution</mat-label>
            <input matInput [(ngModel)]="img.resolution" (ngModelChange)="onMultiImageChange()" name="imageResolution{{i}}" placeholder="e.g. 300dpi">
          </mat-form-field>
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Format</mat-label>
            <mat-select [(ngModel)]="img.format" (selectionChange)="onMultiImageChange()" name="imageFormat{{i}}">
              <mat-option *ngFor="let fmt of imageFormats" [value]="fmt.value">{{ fmt.label }}</mat-option>
            </mat-select>
          </mat-form-field>
        </mat-card-content>
      </mat-card>
    </ng-container>
    <button mat-raised-button color="primary" (click)="addImage()" style="margin-top: 1rem;">
      <mat-icon>add</mat-icon> Add Image
    </button>
  </div>
</section>
