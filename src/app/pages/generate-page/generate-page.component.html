<mat-sidenav-container class="generate-page-container mat-app-background" autosize>
  <!-- Brand Sidebar (if any) -->
  <!-- You can add a brand sidenav here if needed -->

  <!-- Content Templates Sidenav -->
  <mat-sidenav #templateSidenav mode="side" opened class="template-sidenav">
    <div class="sidebar-header">
      <span class="sidebar-title">Content Templates</span>
      <button mat-icon-button color="primary" (click)="createNewTemplate()" matTooltip="Create New Template">
        <mat-icon>add</mat-icon>
      </button>
    </div>
    <mat-nav-list>
      <a mat-list-item *ngFor="let t of templates" (click)="selectTemplate(t)" [class.selected]="t.id === templateId">
        <mat-icon matListItemIcon>description</mat-icon>
        <span matLine>{{ t.templateInfo?.name || 'Untitled' }}</span>
      </a>
      <div *ngIf="!templates.length" class="sidebar-empty">No templates found for this brand.</div>
    </mat-nav-list>
  </mat-sidenav>

  <!-- Main Content -->
  <mat-sidenav-content>
    <main class="main-content">
      <ng-container *ngIf="brandId && templateData && templateData.templateInfo && templateData.settings && templateData.settings.promptTemplate; else emptyState">
        <mat-card>
          <mat-card-header>
            <mat-card-title>{{ templateId ? 'Edit Content Template' : 'Create Content Template' }}</mat-card-title>
          </mat-card-header>
          <mat-divider></mat-divider>
          <mat-card-content>
            <form class="template-info-form">
              <!-- Template Info Section -->
              <section class="form-section">
                <h3 mat-subheader>Template Info</h3>
                <div class="form-row">
                  <mat-form-field appearance="outline" class="form-field">
                    <mat-label>Template Name</mat-label>
                    <input matInput [(ngModel)]="templateData.templateInfo.name" name="templateName" maxlength="100" required>
                  </mat-form-field>
                  <mat-form-field appearance="outline" class="form-field">
                    <mat-label>Content Type</mat-label>
                    <mat-select [(ngModel)]="templateData.templateInfo.contentType" name="contentType" required>
                      <mat-option *ngFor="let type of supportedContentTypes" [value]="type">
                        {{ type.charAt(0).toUpperCase() + type.slice(1).replace('-', ' ') }}
                      </mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>
                <div class="description-row">
                  <mat-form-field appearance="outline" class="form-field full-width">
                    <mat-label>Description</mat-label>
                    <textarea matInput [(ngModel)]="templateData.templateInfo.description" name="description" rows="2" maxlength="500"></textarea>
                  </mat-form-field>
                </div>
                <div class="platform-row">
                  <span class="platform-label">Platforms</span>
                  <div class="platform-checkboxes">
                    <mat-checkbox *ngFor="let platform of supportedPlatforms"
                      [checked]="(templateData.templateInfo.socialAccounts || []).includes(platform)"
                      (change)="togglePlatform(platform, $event.checked)"
                      [name]="'platformCheckbox' + platform">
                      {{ platform.charAt(0).toUpperCase() + platform.slice(1) }}
                    </mat-checkbox>
                  </div>
                </div>
              </section>

              <!-- Content Editor Section -->
              <section class="form-section">
                <ng-container [ngSwitch]="templateData.settings.contentItem.type">
                  <app-content-text-editor
                    *ngSwitchCase="'text'"
                    [text]="templateData.settings.contentItem">
                  </app-content-text-editor>
                  <app-content-image-editor
                    *ngSwitchCase="'image'"
                    [image]="templateData.settings.contentItem">
                  </app-content-image-editor>
                  <app-content-multi-image-editor
                    *ngSwitchCase="'multiImage'"
                    [multiImage]="templateData.settings.contentItem">
                  </app-content-multi-image-editor>
                  <app-content-video-editor
                    *ngSwitchCase="'video'"
                    [video]="templateData.settings.contentItem">
                  </app-content-video-editor>
                  <div *ngSwitchDefault class="editor-placeholder">
                    <em>Select a content type to edit content.</em>
                  </div>
                </ng-container>
              </section>
            </form>
          </mat-card-content>
        </mat-card>
      </ng-container>
      <ng-template #emptyState>
        <div class="empty-state">
          <mat-icon>auto_awesome</mat-icon>
          <h2>No Brand Selected</h2>
          <p>Select a brand to start generating content</p>
        </div>
      </ng-template>
    </main>
  </mat-sidenav-content>
</mat-sidenav-container>

<style>
  .form-row {
    display: flex;
    gap: 16px;
  }
  .form-field {
    flex: 1 1 0;
    min-width: 0;
  }
  .description-row {
    margin-top: 16px;
    width: 100%;
    display: flex;
  }
  .form-field.full-width {
    width: 100%;
    flex: 1 1 100%;
    min-width: 0;
  }
</style>
