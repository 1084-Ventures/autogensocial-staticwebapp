<mat-sidenav-container class="content-template-page-container mat-app-background" autosize style="min-height: 100vh;">
  <!-- Brand Sidebar (if any) -->
  <!-- You can add a brand sidenav here if needed -->

  <!-- Content Templates Sidenav -->
  <mat-sidenav #templateSidenav mode="side" opened class="template-sidenav" style="width: 320px; box-shadow: var(--mat-elevation-3, 0 4px 8px rgba(0,0,0,0.12));">
    <mat-toolbar color="primary" class="sidebar-header" style="display: flex; justify-content: space-between; align-items: center;">
      <span class="sidebar-title" style="font-weight: 600;">Content Templates</span>
      <button mat-mini-fab color="accent" (click)="createNewTemplate()" matTooltip="Create New Template">
        <mat-icon>add</mat-icon>
      </button>
    </mat-toolbar>
    <mat-nav-list>
      <a mat-list-item *ngFor="let t of templates" (click)="selectTemplate(t)" [class.selected]="t.id === templateId" style="border-radius: 8px; margin-bottom: 4px;">
        <mat-icon matListItemIcon color="primary">description</mat-icon>
        <span matLine>{{ t.templateInfo?.name || 'Untitled' }}</span>
      </a>
      <div *ngIf="!templates.length" class="sidebar-empty" style="padding: 1rem; color: #888;">No templates found for this brand.</div>
    </mat-nav-list>
  </mat-sidenav>

  <!-- Main Content -->
  <mat-sidenav-content>
    <main class="main-content" style="padding: 2rem; max-width: 900px; margin: 0 auto;">
      <ng-container *ngIf="brandId && templateData && templateData.templateInfo && templateData.settings && templateData.settings.promptTemplate; else emptyState">
        <mat-card style="box-shadow: var(--mat-elevation-4, 0 6px 16px rgba(0,0,0,0.13)); border-radius: 16px;">
          <mat-card-header>
            <mat-card-title style="font-size: 1.5rem; font-weight: 600;">{{ templateId ? 'Edit Content Template' : 'Create Content Template' }}</mat-card-title>
          </mat-card-header>
          <mat-divider></mat-divider>
          <mat-card-content>
            <form class="template-info-form" style="display: flex; flex-direction: column; gap: 2rem;">
              <!-- Atomic Editor Components -->
              <app-template-info-editor
                [templateInfo]="templateData.templateInfo"
                (templateInfoChange)="onTemplateInfoChange($event)">
              </app-template-info-editor>
              <mat-divider></mat-divider>
              <ng-container *ngIf="templateData.schedule">
                <app-schedule-editor
                  [schedule]="templateData.schedule"
                  (scheduleChange)="onScheduleChange($event)">
                </app-schedule-editor>
                <mat-divider></mat-divider>
              </ng-container>
              <ng-container *ngIf="templateData.settings && templateData.settings.promptTemplate">
                <app-prompt-template-editor
                  [promptTemplate]="templateData.settings.promptTemplate"
                  (promptTemplateChange)="onPromptTemplateChange($event)">
                </app-prompt-template-editor>
                <mat-divider></mat-divider>
              </ng-container>
              <ng-container *ngIf="templateData.settings && templateData.settings.visualStyle">
                <app-visual-style-editor
                  [visualStyle]="templateData.settings.visualStyle"
                  (visualStyleChange)="onVisualStyleChange($event)">
                </app-visual-style-editor>
                <mat-divider></mat-divider>
              </ng-container>
              <ng-container *ngIf="templateData.settings && templateData.settings.contentItem">
                <app-content-item-editor
                  [contentItem]="templateData.settings.contentItem"
                  (contentItemChange)="onContentItemChange($event)">
                </app-content-item-editor>
              </ng-container>
            </form>
          </mat-card-content>
          <mat-card-actions align="end" style="padding: 1rem 2rem;">
            <button mat-raised-button color="primary" style="margin-right: 1rem;">Save</button>
            <button mat-stroked-button color="warn">Delete</button>
          </mat-card-actions>
        </mat-card>
      </ng-container>
      <ng-template #emptyState>
        <mat-card style="margin-top: 2rem; text-align: center; padding: 2rem; color: #888;">
          <mat-icon style="font-size: 3rem; margin-bottom: 1rem;">info</mat-icon>
          <div class="empty-state">No content template selected.</div>
        </mat-card>
      </ng-template>
    </main>
  </mat-sidenav-content>
</mat-sidenav-container>
